import api from './api';

export interface Card {
  _id: string;
  playerName: string;
  sport: string;
  year: number;
  manufacturer: string;
  setName: string;
  cardNumber: string;
  frontImage: string;
  backImage: string;
  condition: {
    centering: number;
    corners: number;
    edges: number;
    surface: number;
    overall: string;
  };
  isRookieCard: boolean;
  isAutograph: boolean;
  isMemorabilia: boolean;
  estimatedValue: number;
  marketValue: number;
  tags: string[];
  notes: string;
  lotNumber?: string;
  isForTrade: boolean;
  userId: string;
  createdAt: string;
  updatedAt: string;
}

export interface CollectionStats {
  totalCards: number;
  totalValue: number;
  recentCards: Card[];
  sportBreakdown: Array<{
    _id: string;
    count: number;
  }>;
}

// Description: Get collection statistics
// Endpoint: GET /api/cards/stats
// Request: {}
// Response: { success: boolean, stats: CollectionStats }
export const getCollectionStats = async () => {
  try {
    console.log('[PERFORMANCE] Starting getCollectionStats API call...');
    const startTime = Date.now();
    const response = await api.get('/api/cards/stats');
    console.log(`[PERFORMANCE] getCollectionStats completed in ${Date.now() - startTime}ms`);
    return response.data;
  } catch (error: any) {
    console.error('[PERFORMANCE] getCollectionStats failed:', error);
    throw new Error(error?.response?.data?.error || error.message);
  }
};

// Description: Get all cards in collection
// Endpoint: GET /api/cards
// Request: {}
// Response: { success: boolean, cards: Card[] }
export const getCards = async () => {
  try {
    console.log('[PERFORMANCE] Starting getCards API call...');
    const startTime = Date.now();
    const response = await api.get('/api/cards');
    console.log(`[PERFORMANCE] getCards completed in ${Date.now() - startTime}ms`);
    return response.data;
  } catch (error: any) {
    console.error('[PERFORMANCE] getCards failed:', error);
    throw new Error(error?.response?.data?.error || error.message);
  }
};

// Description: Get a single card by ID
// Endpoint: GET /api/cards/:id
// Request: {}
// Response: { success: boolean, card: Card }
export const getCard = async (id: string) => {
  try {
    console.log(`[PERFORMANCE] Starting getCard API call for ID: ${id}...`);
    const startTime = Date.now();
    const response = await api.get(`/api/cards/${id}`);
    console.log(`[PERFORMANCE] getCard completed in ${Date.now() - startTime}ms`);
    return response.data;
  } catch (error: any) {
    console.error('[PERFORMANCE] getCard failed:', error);
    throw new Error(error?.response?.data?.error || error.message);
  }
};

// Description: Add a new card to collection
// Endpoint: POST /api/cards
// Request: { playerName: string, sport: string, year: number, manufacturer: string, setName: string, cardNumber: string, frontImage: string, backImage: string, condition: object, estimatedValue: number, ... }
// Response: { success: boolean, message: string, card: Card }
export const addCard = async (cardData: Partial<Card>) => {
  try {
    console.log('[PERFORMANCE] Starting addCard API call...');
    const startTime = Date.now();
    const response = await api.post('/api/cards', cardData);
    console.log(`[PERFORMANCE] addCard completed in ${Date.now() - startTime}ms`);
    return response.data;
  } catch (error: any) {
    console.error('[PERFORMANCE] addCard failed:', error);
    throw new Error(error?.response?.data?.error || error.message);
  }
};

// Description: Update an existing card
// Endpoint: PUT /api/cards/:id
// Request: { playerName?: string, sport?: string, year?: number, ... }
// Response: { success: boolean, message: string, card: Card }
export const updateCard = async (id: string, cardData: Partial<Card>) => {
  try {
    console.log(`[PERFORMANCE] Starting updateCard API call for ID: ${id}...`);
    const startTime = Date.now();
    const response = await api.put(`/api/cards/${id}`, cardData);
    console.log(`[PERFORMANCE] updateCard completed in ${Date.now() - startTime}ms`);
    return response.data;
  } catch (error: any) {
    console.error('[PERFORMANCE] updateCard failed:', error);
    throw new Error(error?.response?.data?.error || error.message);
  }
};

// Description: Delete a card
// Endpoint: DELETE /api/cards/:id
// Request: {}
// Response: { success: boolean, message: string }
export const deleteCard = async (id: string) => {
  try {
    console.log(`[PERFORMANCE] Starting deleteCard API call for ID: ${id}...`);
    const startTime = Date.now();
    const response = await api.delete(`/api/cards/${id}`);
    console.log(`[PERFORMANCE] deleteCard completed in ${Date.now() - startTime}ms`);
    return response.data;
  } catch (error: any) {
    console.error('[PERFORMANCE] deleteCard failed:', error);
    throw new Error(error?.response?.data?.error || error.message);
  }
};